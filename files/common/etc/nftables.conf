#!/usr/sbin/nft -f
 
flush ruleset                                                                                       
 
table inet filter {
        chain input {
                type filter hook input priority 0; policy drop;
 
                # accept any localhost traffic
                iifname lo accept
 
                # accept traffic originated from us
                ct state related,established accept
 
                #allow icmp 
                ip protocol icmp counter accept
                icmpv6 type echo-request limit rate 5/second accept
 
                # allow ipsec
                udp dport 500 counter accept
                ip protocol esp counter accept
                ip protocol ah counter accept
        		# pptp internet
        		ip protocol gre counter accept
 
                # allow NTP
                udp dport 123 counter accept
                udp sport 123 counter accept
 
                # lan routing
                ip saddr 172.16.64.0/22 ip daddr 172.16.64.0/22 counter accept
 
                # accept neighbour discovery otherwise IPv6 connectivity breaks.
                ip6 nexthdr icmpv6 icmpv6 type { nd-neighbor-solicit,  nd-router-advert, nd-neighbor-advert } accept
 
        }
        chain forward {
                type filter hook forward priority 0; policy drop;
                ct state invalid  counter drop
                ct state related,established  counter accept
                
        }
        chain output {
                type filter hook output priority 0; policy accept;
                ct state related,established  counter accept
        }
}
